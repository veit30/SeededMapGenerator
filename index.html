<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mapper</title>
    <link rel="stylesheet" href="./assets/css/styles.css" type="text/css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/lib/alea.min.js"></script>
    <script src="./assets/js/utils.js" type="text/javascript"></script>
    <script src="./assets/js/noise.js" type="text/javascript"></script>
    <script src="./assets/js/mapper.js" type="text/javascript"></script>
    <script src="./assets/js/controls.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="flex-center">
      <canvas id="canvas"></canvas>
      <p id="current-color"></p>
    </div>
    <script type="text/javascript">
      // GLOBALS
      const WIDTH = 512;
      const GRID_SIZE = 4;
      const RESOLUTION = 64;
      const COLOR_SCALE = 255;

      // CANVAS
      let canvas = document.getElementById("canvas");
      canvas.width = canvas.height = WIDTH;
      let ctx = canvas.getContext("2d");

      // NOISE
      function renderNoiseGridOnCanvas(grid, gridSize, ctx, color) {
        let width = grid.length;
        let pixelSize = ctx.canvas.width / (width/gridSize);
        for(let i = 0; i < width; i++) {
          for(let j = 0; j < width; j++) {
            ctx.fillStyle = color(grid[i][j]);
            ctx.fillRect(
              i / width * ctx.canvas.width,
              j / width * ctx.canvas.width,
              pixelSize,
              pixelSize,
            )
          }
        }
      }

      function generateNoise() {
        noise.reset(Date.now())
        let grid = noise.perlin2Grid(GRID_SIZE, RESOLUTION);
        // let grid = noise.simplex2Grid(GRID_SIZE, RESOLUTION);
        renderNoiseGridOnCanvas(grid, GRID_SIZE, ctx, utils.colorMapper.simple);
      }

      canvas.addEventListener("click", generateNoise, false)

      generateNoise();

      // TODO: specify controls
      let c = new Controls();
      c.addDropdown("Test", ["Eins", "Zwei", "Drei"]);
      c.setValueChangeCallback(function(key, value) {
        // TODO: specify callback
        console.log("Controls callback:");
        console.log(`Key: ${key}`);
        console.log(`Value: ${value}`);
      })
      c.addRange("range1", {
        min:0,
        max:10,
        step:1,
      })
      c.addBoolean("Test Boolean")
      c.show();
      console.log(c.valueMap);

    </script>
  </body>
</html>
