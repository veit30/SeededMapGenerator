<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mapper</title>
    <link rel="stylesheet" href="./assets/css/styles.css" type="text/css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/lib/alea.min.js"></script>
    <script src="./assets/js/utils.js" type="text/javascript"></script>
    <script src="./assets/js/noise.js" type="text/javascript"></script>
    <script src="./assets/js/mapper.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="flex-center">
      <canvas id="canvas"></canvas>
      <p id="current-color"></p>
    </div>
    <script type="text/javascript">
      // GLOBALS
      const WIDTH = 512;
      const GRID_SIZE = 4;
      const RESOLUTION = 16;
      const COLOR_SCALE = 255;

      // CANVAS
      let canvas = document.getElementById("canvas");
      canvas.width = canvas.height = WIDTH;
      let ctx = canvas.getContext("2d");

      // NOISE
      function renderNoiseOnCanvas(grid, gridSize, ctx) {
        let width = grid.length;
        let pixelSize = ctx.canvas.width / (width/gridSize);
        for(let i = 0; i < width; i++) {
          for(let j = 0; j < width; j++) {
            let colorFrac = parseInt(((grid[i][j]+1)/2)*COLOR_SCALE);
            ctx.fillStyle = utils.rgbToHex(colorFrac,colorFrac,colorFrac);
            ctx.fillRect(
              i / width * ctx.canvas.width,
              j / width * ctx.canvas.width,
              pixelSize,
              pixelSize,
            )
          }
        }
      }

      function generateNoise() {
        noise.reset(Math.random())
        let grid = noise.perlin(GRID_SIZE, RESOLUTION, WIDTH);
        renderNoiseOnCanvas(grid, GRID_SIZE, ctx);
      }

      canvas.addEventListener("click", generateNoise, false)

      generateNoise();

    </script>
  </body>
</html>
